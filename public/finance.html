<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SPA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous">
    </script>
</head>
<body>

<section class="vh-100" style="background-color: #eee;">
    <!--REGISTER-VIEW-->
    <div class="container h-100" style="display: none" id="register-view">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-lg-12 col-xl-11">
                <div class="card text-black" style="border-radius: 25px;">
                    <div class="card-body p-md-5">
                        <div class="row justify-content-center">
                            <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
                                <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">Register SPA account</p>
                                <div class="mx-1 mx-md-4">
                                    <form>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <input type="text" id="register-login" class="form-control"/>
                                                <label class="form-label" for="register-login">Login</label>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-lock fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <input type="password" id="register-password" class="form-control"/>
                                                <label class="form-label" for="register-password">Password</label>
                                            </div>
                                        </div>
                                    </form>
                                    <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                                        <button class="btn btn-primary btn-lg" id="register-button">Register</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2">
                                <img src="/assets/img/draw1.webp"
                                     class="img-fluid" alt="Sample image">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--REGISTER-VIEW-END-->
    <!--LOGIN-VIEW-->
    <div class="container h-100" id="login-view">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-lg-12 col-xl-11">
                <div class="card text-black" style="border-radius: 25px;">
                    <div class="card-body p-md-5">
                        <div class="row justify-content-center">
                            <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
                                <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">Login SPA account</p>
                                <div class="mx-1 mx-md-4">
                                    <form>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <input type="text" id="login-login" class="form-control"/>
                                                <label class="form-label" for="login-login">Login</label>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-lock fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <input type="password" id="login-password" class="form-control"/>
                                                <label class="form-label" for="login-password">Password</label>
                                            </div>
                                        </div>
                                    </form>
                                    <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                                        <button class="btn btn-primary btn-lg" id="login-button">Login</button>&nbsp;
                                        <button class="btn btn-primary btn-lg" id="notRegister-button">Not register
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2">

                                <img src="/assets/img/draw1.webp"
                                     class="img-fluid" alt="Sample image">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--LOGIN-VIEW-END-->
    <div class="container h-100" style="display: none" id="operation-view">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-lg-12 col-xl-11">
                <div class="card text-black" style="border-radius: 25px;">
                    <div class="card-body p-md-5">
                        <div class="row justify-content-center">
                            <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
                                <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">dfd SPA account</p>
                                <div class="mx-1 mx-md-4">
                                    <form>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <input type="text" id="operation-login" class="form-control"/>
                                                <label class="form-label" for="login-login">Login</label>
                                            </div>
                                        </div>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-lock fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <input type="password" id="operation-password" class="form-control"/>
                                                <label class="form-label" for="login-password">Password</label>
                                            </div>
                                        </div>
                                    </form>
                                    <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                                        <button class="btn btn-primary btn-lg" id="operation-button">Login</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2">

                                <img src="/assets/img/draw1.webp"
                                     class="img-fluid" alt="Sample image">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--TABLE-VIEW-->
    <div class="container h-100" style="display: none" id="table-view">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <table class="table" id="table">
                <thead>
                <tr>
                    <th scope="col">Id</th>
                    <th scope="col">Type</th>
                    <th scope="col" id="amount">Amount</th>
                    <th scope="col">Comment</th>
                    <th scope="col">Action</th>

                </tr>
                </thead>
                <tbody id="table-tbody">
                </tbody>
            </table>
            <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                <button class="btn btn-primary btn-lg" id="create-operation-button" data-huy="huyn">Create new
                    operation
                </button>
            </div>
        </div>
    </div>
    <!--  INPUT-OPERATION-INPUT-FORM-VIEW-->
    <div class="container h-100" style="display: none" id="input-operation-view">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-lg-12 col-xl-11">
                <div class="card text-black" style="border-radius: 25px;">
                    <div class="card-body p-md-5">
                        <div class="row justify-content-center">
                            <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
                                <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">New operation</p>
                                <div class="mx-1 mx-md-4 text-center">
                                    <input type="radio" class="btn-check" name="options" id="input-amount button"
                                           autocomplete="off"
                                           checked>
                                    <label class="btn btn-secondary" for="input-amount button">Income</label>
                                    <input type="radio" class="btn-check" name="options" id="input-comment button"
                                           autocomplete="off">
                                    <label class="btn btn-secondary" for="input-comment button">Expense</label><br>
                                    <br>
                                    <form>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <input type="number" min="0" oninput="validity.valid||(value='');"
                                                       id="new-operation-amount" class="form-control"/>
                                                <label class="form-label" for="new-operation-amount">Amount</label>
                                            </div>
                                            <div class="form-outline flex-fill mb-0">
                                                <input type="text" id="new-operation-comment" class="form-control"/>
                                                <label class="form-label" for="new-operation-comment">Comment</label>
                                            </div>
                                        </div>
                                    </form>
                                    <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                                        <button class="btn btn-primary btn-lg" id="new-operation-button">Create</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2">
                                <img src="/assets/img/draw1.webp"
                                     class="img-fluid" alt="Sample image">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--  INPUT-OPERATION-INPUT-FORM-VIEW-END-->
    <!-- Open-Operation-FORM-VIEW   -->
    <div class="container h-100" style="display: none" id="open-operation-form">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-lg-12 col-xl-11">
                <div class="card text-black" style="border-radius: 25px;">
                    <div class="card-body p-md-5">
                        <div class="row justify-content-center">
                            <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
                                <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">Operation ID:
                                    <script></script>
                                </p>
                                <div class="mx-1 mx-md-4 text-center">
                                    <input type="radio" class="btn-check" name="options" id="eeee"
                                           autocomplete="off"
                                           checked>
                                    <label class="btn btn-secondary" for="input-amount button">Income</label>
                                    <input type="radio" class="btn-check" name="options" id="eeeee"
                                           autocomplete="off">
                                    <label class="btn btn-secondary" for="input-comment button">Expense</label><br>
                                    <br>
                                    <form>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                            <div class="form-outline flex-fill mb-0">
                                                <input type="number" min="0" oninput="validity.valid||(value='');"
                                                       id="xxx1" class="form-control"/>
                                                <label class="form-label" for="xxx1">Amount</label>
                                            </div>
                                            <div class="form-outline flex-fill mb-0">
                                                <input type="text" id="xxx" class="form-control"/>
                                                <label class="form-label" for="xxx">Comment</label>
                                            </div>
                                        </div>
                                    </form>
                                    <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                                        <button class="btn btn-primary btn-lg" id="open-operation-back-to-list">Back to
                                            list
                                        </button>&nbsp;
                                        <button class="btn btn-primary btn-lg" id="open-operation-delete-operation">
                                            Delete
                                        </button>
                                        <!--                                        TODO Make delete operation-->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</section>
<script>

    function tableGeneration(transaction) {
        let row = `<tr><th scope="row">${transaction.id}</th><td>${transaction.is_income}</td><td>${transaction.amount}</td><td>${transaction.comment}</td><td><button class="btn btn-primary btn-lg operation-open" data-id="${transaction.id}">Open</button></td></tr>`;
        document.getElementById("table-tbody").innerHTML += row;
    }

    /**
     * @param {Response} response
     */
    async function respondCodeLogic(response) {
        const result = await response.json();

        if (result.success === true) {
            document.getElementById("login-view").style.display = "none";
            document.getElementById("register-view").style.display = "none";
            document.getElementById("table-view").style.removeProperty('display');

            result.data.forEach((transaction) => {
                tableGeneration(transaction)
            });

            // sum of amount rows.
            let sum = 0;
            let table = document.getElementById("table");
            let sumVal = 0;
            for (let i = 1; i < table.rows.length; i++) {
                let rowAmount = parseInt(table.rows[i].cells[2].innerHTML);
                sumVal = sumVal + rowAmount;
            }
            console.log(sumVal);

            //listened for open buttons
            let list = document.getElementsByClassName("operation-open");
            for (let item of list) {
                item.onclick = operationOpenTargetDatasetId;
            }

        }
    }

    function showInputFormOperation() {

        document.getElementById("login-view").style.display = "none";
        document.getElementById("register-view").style.display = "none";
        document.getElementById("table-view").style.display = "none";
        document.getElementById("input-operation-view").style.removeProperty('display');
    }

    document.getElementById("create-operation-button").onclick = showInputFormOperation;

    function openOperationBackToList() {

        document.getElementById("login-view").style.display = "none";
        document.getElementById("register-view").style.display = "none";
        document.getElementById("table-view").style.removeProperty('display');
        document.getElementById("input-operation-view").style.display = "none";
    }

    document.getElementById("open-operation-back-to-list").onclick = openOperationBackToList;

    function notRegistered() {

        document.getElementById("register-view").style.removeProperty('display');
    }

    document.getElementById("notRegister-button").onclick = notRegistered;

    async function registerJSON() {

        let password = document.getElementById("register-password").value;
        let login = document.getElementById("register-login").value;
        let myObj = {login: login, password: password};
        let json = JSON.stringify(myObj);

        try {
            const response = await fetch("/register", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: json,
            });

            await respondCodeLogic(response);

        } catch (error) {
            alert(error);
        }
    }

    async function loginJSON() {
        let password = document.getElementById("register-password").value;
        let login = document.getElementById("register-login").value;
        let myObj = {login: login, password: password};
        let json = JSON.stringify(myObj);
        try {
            const response = await fetch("/operation", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: json,
            });

            await respondCodeLogic(response);
        } catch (error) {
            alert(error);
        }
    }

    document.getElementById("register-button").onclick = registerJSON;
    document.getElementById("login-button").onclick = loginJSON;

    //get id for open buttons
    function operationOpenTargetDatasetId(target) {
        let targetIdNumber = target.target.dataset.id;
        console.log(targetIdNumber);

        document.getElementById("login-view").style.display = "none";
        document.getElementById("register-view").style.display = "none";
        document.getElementById("table-view").style.display = "none";
        document.getElementById("input-operation-view").style.display = "none";
        document.getElementById("open-operation-form").style.removeProperty('display');

    }

    document.getElementsByClassName("operation-open").onclick = operationOpenTargetDatasetId;


</script>
</body>
</html>
